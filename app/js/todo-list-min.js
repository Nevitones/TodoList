var TodoModel=Backbone.Model.extend({defaults:function(){return{done:!1,description:""}}}),TodoCollection=Backbone.Collection.extend({url:"http://localhost:9595",model:TodoModel}),TodoModelView=Backbone.View.extend({tagName:"li",className:"todo-list-item",model:new TodoModel,events:{"click a":"delete","click input":"close","blur .description":"close","dblclick .description":"edit","keypress .description":"onKeypress"},initialize:function(){this.template=templates.TodoModelView,this.listenTo(this.model,"change:done",this.doneChanged)},render:function(){return this.$el.html(this.template(this.model.toJSON())).removeClass("done").addClass(this.model.get("done")?"done":""),this},"delete":function(a){a.preventDefault();var b=this;b.model.destroy({success:function(){b.$el.animate({marginTop:-b.$el.outerHeight(),opacity:0},250,function(){b.remove()})}})},edit:function(){this.$el.find(".description").attr("contenteditable",!0).focus()},onKeypress:function(a){13===a.keyCode&&this.$el.find(".description").blur()},close:function(){var a=this.$el.find(".description").removeAttr("contenteditable").text(),b=this.$el.find("input").prop("checked");this.model.set({description:a.replace(/</g,"&lt").replace(/>/g,"&gt"),done:b}),this.model.save()},doneChanged:function(){this.render()}}),TodoCollectionView=Backbone.View.extend({initialize:function(){this.collection=new TodoCollection,this.listenTo(this.collection,"add",this.itemAdded)},render:function(){return this.$el.empty(),this.collection.fetch(),this},itemAdded:function(a){var b=new TodoModelView({model:a});this.$el.append(b.render().$el),b.render().$el.css({marginTop:-b.render().$el.outerHeight(),opacity:0}).animate({marginTop:0,opacity:1},250),a.isNew()&&b.edit()}}),TodoMainView=Backbone.View.extend({el:"body",events:{"click button":"addItem"},initialize:function(){this.template=templates.TodoMainView,this.$el.append(this.template()),this.todoCollectionView=new TodoCollectionView({el:this.$el.find("#todoList")}).render()},addItem:function(){this.todoCollectionView.collection.add(new TodoModel)}}),todoMainView=new TodoMainView;